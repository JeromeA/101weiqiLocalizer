const object = {
    // problems
    '围棋闯关': 'Exam',
    '棋力测试': 'Strength Test',
    '关卡': 'Checkpoint',
    '提供': 'supplier',   // of a problem
    '我的解答': 'My answer',
    '错误': 'Mistake',
    '编号': 'Serial number',
    '旋转棋盘': 'Rotate board',
    '棋盘居中': 'Center board',
    '落子确认关闭中，开启': 'Toggle move confirmation',
    '剩余': 'Remaining',
    '显示答案': 'Show answers',
    '从错题本中删除': 'Remove from mistakes book',
    '请直接用鼠标在棋盘上落子': 'Use the mouse to play stones',
    '注意': 'Notice',
    '只有一次提交解答的机会': 'Only one opportunity to submit answers',
    '只有2次提交解答的机会': 'Only two opportunities to submit answers',
    '只有': 'Only',
    '次提交解答的机会': 'opportunities to submit answers',
    '今日排行榜': "Today's Leaderboard",
    '本题已经通过': 'Problem passed',
    '本题超时未通过': 'Problem failed by timeout',
    '本题未通过': 'Problem failed',
    '創作': 'creation',  // problem author
    '本题收录于': 'Problem is included in',
    '我的评论': 'My comment',
    '添加评论': 'Add comment',
    '隐藏题目审核': 'Hidden review',
    '题目质量': 'Problem quality',
    '我的评分': 'My rating',
    '标注难度': 'Set difficulty',

    // edit problem
    '条修改记录': 'Modification record',
    '所有编辑记录': 'All edit records',
    '编辑记录': 'Edit record',
    '修改类型': 'Modification type',
    '修改前': 'Before modification',
    '修改后': 'After modification',
    '题目知识点': 'Topic category',
    '修改于': 'modified on',   // date

    '死活题': 'life-and-death problem',
    '手筋题': 'Tesuji problem',
    '吃子题': 'Capture problem',
    '定式题': 'Joseki problem',

    '闯关结果': 'Results',
    '棋力检测': 'Strength detection',
    '再次闯关': 'Break through again',
    '闯下一关': 'Break the next level',
    '闯关成功': 'Successfully passed the barrier',
    '闯关失败': 'Failed to break through',

    // problem buttons
    '对战': 'Play',
    '试下': 'Try',
    '研究': 'Research',
    '提交答案': 'Submit answer',
    '上一题': 'Previous problem',
    '上 一 题': 'Previous problem',
    '下一题': 'Next problem',
    '下 一 题': 'Next problem',
    '上一步': 'Undo move',
    '上 一 定 式': 'Previous joseki',
    '下 一 定 式': 'Next joseki',

    // /task/
    '尚未完成的作业': 'Unfinished tasks',
    '我的作业列表': 'My task list',
    '作业日期': 'Task date',
    '作业状态': 'State',
    '作业难度': 'Difficulty',
    '题目数量': 'Count',  // number of problems
    '用时': 'Time spent',
    '完成时间': 'Completion date',
    '我的作业模板列表': 'My tasks template list',
    '创建新的作业模板': 'Create a new tasks template',
    '我的作业本': 'My tasks book',
    '作业本名称': 'Workbook name',
    '刚创建': 'Created',
    '已完成': 'Completed',
    '正在做': 'Doing',
    '我的作业': 'My tasks',
    '作业': 'Tasks',
    '得分': 'Score',
    '排行榜': 'Leaderboard',

    // /task/do
    '做一题设置': 'Problem setup',
    '做一题': 'Do problem',
    '今日完成': 'Completed today',
    '做对': 'Correct',
    '正确率': 'Correct rate',
    '平均难度': 'Average difficulty',

    // star
    '我收藏的题目': 'Bookmarked problems',
    '取消收藏': 'Remove bookmark',
    '我的收藏本': 'My collection',
    '我的标签': 'My tags',
    '添加': 'Add',
    '收藏此题': 'Bookmark problem',
    '已经取消': 'Already cancelled',

    // /questionlib
    '级位题目分类': 'Kyu-level classification',
    '段位题目分类': 'Dan-level classification',
    '棋盘大小分类': 'Board size classification',
    '其他分类题目': 'Other classification',
    '官子题目列表': 'Endgame album',
    // topic names have 题目 (topic) at the end, but let's leave that out
    '官子题目': 'Endgame',
    '吃子题目': 'Capture',
    '骗招题目': 'Trick plays',
    '题目': 'Topic',

    // nav and headers
    '我的首页': 'My Home',
    '棋 力 测 试': 'Go Strength Test',
    '围棋闯关-棋力测试': 'Go Strength Test',  // guan
    '每日八题': 'Daily 8 problems',
    '我的错题本': 'My mistakes book',
    '最近棋谱': 'Recent games',
    '贡献较多的棋友名单': 'Top contributors',
    '题库状态': 'Problem library state',
    '题库': 'Library',
    '训练营': 'Training camp',
    '讨论区': 'Forum',
    '对弈': 'Game',
    '棋谱': 'Records',
    '棋书': 'Books',
    '围棋知识点专辑': 'Categories album',
    '围棋考试/挑战赛': 'Go exam/challenge',
    '帮助中心': 'Help center',
    '个人信息设置': 'Personal information settings',

    '错题统计': 'Mistake statistics',
    '错题详细统计': 'Detailed mistake statistics',
    '错题重做': 'Rework mistakes',

    // categories
    '围棋基本技能': 'Basic Go skills',
    '围棋死活形状': 'Life-and-death shapes',
    '围棋基本手筋': 'Basic tesuji',
    '围棋经典手筋': 'Classic tesuji',
    '围棋综合手筋': 'Comprehensive tesuji',

    '吃子': 'Capture',
    '对杀': 'Capturing race',
    '有眼杀无眼': 'Eye/no eye',
    '连接': 'Connect',
    '切断': 'Cut',
    '大头鬼': 'Tombstone',
    '金鸡独立': 'Golden rooster',
    '倒脱靴': 'Under the stones',
    '接不归': 'Connect and die',
    '胀牯牛': 'Squash',
    '金柜角': "Carpenter's square",
    '黄莺扑蝶': 'Raccoon belly',
    '滚打包收': 'Squeeze',
    '盘角曲四': 'Bent 4 in the corner',
    '腾挪': 'Sabaki',
    '左右同型': 'Symmetrical shape',
    '打劫': 'Ko',
    '七死八活': 'Seven die, eight live',
    '大猪嘴': 'Big pig snout',
    '小猪嘴': 'Small pig snout',
    '一一妙手': '1-1 point',
    '一二妙手': '1-2 point',

    '立': 'Descent, stand',
    '弃子': 'Sacrifice',

    // book and player names
    '围棋手筋辞典': 'Tesuji Dictionary',
    '濑越宪作': 'Segoe Kensaku',
    '吴清源': 'Go Seigen',

    // modern player names
    '李钦诚': 'Li Qincheng',
    '王楚轩': 'Wang Chuxuan',
    '芈昱廷': 'Mi Yuting',
    '廖元赫': 'Liao Yuanhe',
    '丁浩': 'Ding Hao',
    '时越': 'Shi Yue',
    '周睿羊': 'Zhou Ruiyang',
    '童梦成': 'Tong Mengcheng',
    '伊凌涛': 'Yi Lingtao',
    '李轩豪': 'Li Xuanhao',
    '陈贤': 'Chen Xian',
    '连笑': 'Lian Xiao',
    '檀啸': 'Tan Xiao',
    '唐韦星': 'Tang Weixing',
    '陳禧': 'Chen Xi',

    // Joseki
    '定式大全': 'Joseki encyclopedia',
    '星定式': 'Star-point joseki',
    '三三定式': '3-3 point joseki',
    '小目定式': '3-4 point joseki',
    '目外定式': '3-5 point joseki',
    '高目定式': '4-5 point joseki',
    '五五定式': '5-5 point joseki',
    '三六定式': '3-6 point joseki',
    '四六定式': '4-6 point joseki',
    '小类': 'subcategories',

    // others
    '更多': 'More',
    '白先': 'White to play',
    '黑先': 'Black to play',
    '死活': 'life-and-death',
    '分': 'min',
    '秒': 'sec',
    '难度': 'Difficulty',
    '職業四段': '4p',
    '级': 'kyu',
    '段': 'dan',
    '普通会员': 'Ordinary member',
    '升级': 'Upgrade',
    '充值': 'Recharge',
    '开始做题': 'Start problems',
    '最快': 'Fastest',
    '确定': 'OK',
    '取消': 'Cancel',
    '正确': 'Correct',
    '超时': 'Timeout',
    '恭喜': 'Congratulations',
    '上一页': 'Previous page',
    '下一页': 'Next page',
};

// I translated 知识点 as 'category' (lit. 'knowledge point')

recursiveReplace(document.body);

let observer = new MutationObserver(mutationRecords => {
    let nodes = []
    mutationRecords.forEach(m => {
        if (m.type == 'characterData') {
            nodes.push(m.target)
        }
        observer.disconnect()    // avoid infinite loops
        console.log(nodes)
        nodes.forEach(node => replaceInTextNode(node))
        observe()
    })
})

const observe = () => {
    observer.observe(document, {
        characterData: true,
        subtree: true,
    });
}

observe()

/*
    Recurse through DOM elements.  If element is a text element process it, otherwise recurse.
*/
function recursiveReplace(node) {
    if (node.nodeType == 3 && node.nodeName != 'SCRIPT') {
        replaceInTextNode(node)
    } else if (node.nodeType == 1 && node.nodeName != 'SCRIPT' && node.nodeName != 'STYLE') {
        var child = node.firstChild;
        while (child) {
        	recursiveReplace(child);
        	child = child.nextSibling;
        }
    }
}

function replaceInTextNode(node) {
    s = node.nodeValue
    for (const [key, value] of Object.entries(object)) {
        s = s.replace(key, value)
    }

    // non-fixed strings
    s = s.replace(/(20\d\d)年(\d\d?)月(\d\d?)日/,
        (match, year, month, day) => [ year, month, day ].join('.')
    )
    s = s.replace(/第\s*(\d+)\s*题/,
        (match, number) => `Problem ${number}`
    )
    node.nodeValue = s
}
